<!-- Основная страница: таблица файлов, адресная строка, кнопки действий -->
<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:TelegramFileStorage.ViewModels"
        xmlns:views="clr-namespace:TelegramFileStorage.Views"
        x:Class="TelegramFileStorage.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="Telegram File Storage" Width="900" Height="600">
    <Design.DataContext>
        <vm:MainWindowViewModel/>
    </Design.DataContext>
    <Window.Resources>
        <vm:SettingsViewModel x:Key="SettingsVM" />
        <views:PageTypeToBoolConverter x:Key="PageTypeToBoolConverter" />
    </Window.Resources>
    <DockPanel>
        <!-- Кнопки действий -->
        <StackPanel Orientation="Horizontal" DockPanel.Dock="Top" Margin="8">
            <Button Content="Скачать" Margin="0,0,8,0" Command="{Binding DownloadCommand}"/>
            <Button Content="Загрузить" Margin="0,0,8,0" Command="{Binding UploadCommand}"/>
            <Button Content="Переместить" Margin="0,0,8,0" Command="{Binding MoveCommand}"/>
            <Button Content="Удалить" Margin="0,0,8,0" Command="{Binding DeleteCommand}"/>
            <Button Content="Настройки" Command="{Binding SettingsCommand}"/>
        </StackPanel>
        <!-- Страница файлов -->
        <StackPanel IsVisible="{Binding CurrentPage, Converter={StaticResource PageTypeToBoolConverter}, ConverterParameter=Files}">
            <StackPanel Orientation="Horizontal" Margin="8">
                <TextBlock Text="Путь:" VerticalAlignment="Center"/>
                <TextBox Text="{Binding CurrentPath, Mode=TwoWay}" Width="400" Margin="8,0,0,0"/>
            </StackPanel>
            <DataGrid ItemsSource="{Binding Files}" AutoGenerateColumns="False" Margin="8" GridLinesVisibility="All">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Имя" Binding="{Binding Name}" Width="*"/>
                    <DataGridTextColumn Header="Путь" Binding="{Binding VirtualPath}" Width="2*"/>
                    <DataGridTextColumn Header="Размер" Binding="{Binding Size}" Width="*"/>
                    <DataGridTextColumn Header="Хеш" Binding="{Binding Hash}" Width="*"/>
                    <DataGridCheckBoxColumn Header="Удалён" Binding="{Binding IsDeleted}" Width="*"/>
                </DataGrid.Columns>
            </DataGrid>
        </StackPanel>
        <!-- Страница настроек -->
        <Grid IsVisible="{Binding CurrentPage, Converter={StaticResource PageTypeToBoolConverter}, ConverterParameter=Settings}" Margin="8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="180"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <!-- Карта настроек -->
            <ListBox Grid.Column="0" Items="{Binding Settings.Categories}" SelectedItem="{Binding Settings.SelectedCategory, Mode=TwoWay}">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <TextBlock Text="{Binding}"/>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
            <!-- Настройки выбранной категории -->
            <StackPanel Grid.Column="1" Margin="16,0,0,0">
                <ContentControl Content="{Binding Settings.SelectedCategory}">
                    <ContentControl.DataTemplates>
                        <DataTemplate DataType="vm:SettingsViewModel+SettingsCategory">
                            <StackPanel>
                                <!-- Основные -->
                                <StackPanel IsVisible="{Binding Settings.SelectedCategory, Converter={StaticResource PageTypeToBoolConverter}, ConverterParameter=Main}">
                                    <TextBlock Text="Тема, выход, смена пароля (заглушка)"/>
                                </StackPanel>
                                <!-- Telegram -->
                                <StackPanel IsVisible="{Binding Settings.SelectedCategory, Converter={StaticResource PageTypeToBoolConverter}, ConverterParameter=Telegram}">
                                    <TextBlock Text="Bot Token"/>
                                    <TextBox Text="{Binding Settings.TelegramToken, Mode=TwoWay}"/>
                                    <TextBlock Text="Channel ID"/>
                                    <TextBox Text="{Binding Settings.ChannelId, Mode=TwoWay}"/>
                                </StackPanel>
                                <!-- Синхронизация -->
                                <StackPanel IsVisible="{Binding Settings.SelectedCategory, Converter={StaticResource PageTypeToBoolConverter}, ConverterParameter=Sync}">
                                    <CheckBox Content="Синхронизация включена" IsChecked="{Binding Settings.SyncEnabled, Mode=TwoWay}"/>
                                </StackPanel>
                                <!-- Загрузка -->
                                <StackPanel IsVisible="{Binding Settings.SelectedCategory, Converter={StaticResource PageTypeToBoolConverter}, ConverterParameter=Upload}">
                                    <TextBlock Text="Мультипоточная загрузка, количество потоков, ограничение скорости (заглушка)"/>
                                </StackPanel>
                                <!-- Скачивание -->
                                <StackPanel IsVisible="{Binding Settings.SelectedCategory, Converter={StaticResource PageTypeToBoolConverter}, ConverterParameter=Download}">
                                    <TextBlock Text="Параметры скачивания (заглушка)"/>
                                </StackPanel>
                            </StackPanel>
                        </DataTemplate>
                    </ContentControl.DataTemplates>
                </ContentControl>
                <Button Content="Назад" Command="{Binding ShowFilesPageCommand}" HorizontalAlignment="Right" Margin="0,16,0,0"/>
            </StackPanel>
        </Grid>
    </DockPanel>
</Window>
